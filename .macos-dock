#!/bin/bash

# TODO: Make adding dividers possible

# Defaults to your current home directory.
# Set to another home directory if you 
# want to add to another users Dock
TARGET_HOMEDIR=$HOME

# Apps we add to the dock
system_applications=( 
    "/System/Applications/Launchpad.app" 
    "/System/Applications/Home.app" 
    "/System/Applications/Messages.app"
    "/Applications/Chromium.app" 
    "/Applications/VSCodium.app" 
    "/Applications/Bitwarden.app"
    "/Applications/Commander One.app"
    "/Applications/kitty.app"
)

# Clear entire dock
dockutil --remove all

last_app=""
pos=0

for n in ${!system_applications[@]}; do
    ((pos++))

    # Add spacer if requested
    if [ "${system_applications[$n]}" = "" ];
    then
        echo "Add ($pos) : | DIVIDER | "
        
        dockutil --add '' --type spacer --no-restart --section apps --after "$last_app" "$TARGET_HOMEDIR/"
        continue
    fi

    # Check if .app exists
    if [ ! -d "${system_applications[$n]}" ];
    then
        echo "WARNING: App ${system_applications[$n]} does not exist."
        ((pos--))
        continue
    fi

    dockutil --add "${system_applications[$n]}/" --no-restart --position $pos "$TARGET_HOMEDIR/"

    echo "Position $pos : ${system_applications[$n]} "

    # Store last app as variable to be able to use it as '--after App'
    str=${system_applications[$n]}
    if [[ $str =~ .*\/(.*)\.app\/?$ ]]; then
        echo "last app: ${BASH_REMATCH[1]}"
        last_app=${BASH_REMATCH[1]}
    fi
done

# Restart the Dock once to apply changes
killall Dock

