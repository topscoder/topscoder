#!/bin/bash

# See https://github.com/stefansundin/dotfiles/blob/master/setup-mac.sh

# Unlock quarantaine mode for /Applications
# sudo xattr -d -r com.apple.quarantine /Applications
# grep -nr paginator .
# find . -name "*.css" | xargs -l10 grep ".ir"

# Created by Boyan Atanasov, 2019-11-03
# Modified by topscoder

# Removes the quarantine attribute in OSX
# Catalina from runnable applications.
QUARANTINE_ATTR="com.apple.quarantine"

echo -e "Attribute discovery started..."
for APPLICATION in /Applications/*; do

    # See all attributes on app
    ATTRIBUTES=$(sudo xattr "$APPLICATION")
    echo -e $ATTRIBUTES
    # check if attributes contain a quarantine
    # attribute
    if [[ $ATTRIBUTES == *$QUARANTINE_ATTR* ]]; then
        # echo -e "Quarantine attribute found."
        # remove the attribute
        sudo xattr -r -d $QUARANTINE_ATTR "$APPLICATION"
        echo -e "Quarantine attribute removed."
    fi

done    

# Enable "Anywhere" option for Gatekeeper ("Allow apps downloaded from" in "Security & Privacy" settings)
sudo spctl --master-disable

# Prevent Gatekeeper from re-enabling itself after 30 days ("Allow apps downloaded from" in "Security & Privacy")
sudo defaults write /Library/Preferences/com.apple.security GKAutoRearm -bool false
